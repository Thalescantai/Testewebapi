<% content_for :title, "Exames do paciente" %>

<div class="container-xl py-4">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
      <h1 style="margin: 0; font-size: 2rem; font-weight: 600; color: #1f2937;">
        <%= @consulta.paciente&.nome || "Paciente não informado" %>
      </h1>
      <p style="margin: 0.4rem 0 0; color: #6b7280;">
        Consulta realizada em <%= @consulta.data_hora.present? ? l(@consulta.data_hora, format: :long) : "data não informada" %>
        com <%= @consulta.medico&.nome || "profissional não informado" %>.
      </p>
    </div>
    <div>
      <%= link_to "Voltar para fila de exames",
                  exames_path,
                  style: "display: inline-block; padding: 0.55rem 1.1rem; border-radius: 8px; background: #e5e7eb; color: #374151; text-decoration: none; font-weight: 600;" %>
    </div>
  </div>

  <div style="display: grid; gap: 1rem;">
    <% if @exames.any? %>
      <% @exames.each do |exame| %>
        <div style="border: 1px solid #e4e7ef; border-radius: 12px; padding: 1.25rem; background: #fff; box-shadow: 0 2px 6px rgba(15,23,42,0.05);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
            <div>
              <div style="font-size: 1.1rem; font-weight: 600; color: #1f2937;"><%= exame.nome_exame.presence || "Exame não nomeado" %></div>
              <div style="color: #6b7280; font-size: 0.9rem;">
                <strong>Status:</strong> <%= Exame::STATUS_LABELS.fetch(exame.status, exame.status.to_s.humanize) %>
              </div>
            </div>
            <% if exame.data_exame.present? %>
              <div style="font-size: 0.9rem; color: #2563eb; font-weight: 600;">
                Data prevista: <%= l(exame.data_exame) %>
              </div>
            <% end %>
          </div>

          <% if exame.observacao_exame.present? %>
            <div style="margin-top: 0.75rem; color: #4b5563;">
              <strong>Observações:</strong>
              <p style="margin: 0.35rem 0 0;"><%= exame.observacao_exame %></p>
            </div>
          <% end %>

          <% if exame.data_realizacao.present? || exame.profissional_realizou_exame.present? %>
            <div style="margin-top: 0.75rem; color: #374151; font-size: 0.9rem;">
              <strong>Realizado em:</strong>
              <%= exame.data_realizacao ? l(exame.data_realizacao, format: :long) : "—" %>
              <% if exame.profissional_realizou_exame.present? %>
                <span style="margin-left: 0.5rem;">por <%= exame.profissional_realizou_exame %></span>
              <% end %>
            </div>
          <% end %>

          <% if exame.arquivo_resultado.attached? %>
            <div style="margin-top: 0.75rem;">
              <%= link_to "Baixar arquivo", url_for(exame.arquivo_resultado), style: "color: #2563eb; font-weight: 600; text-decoration: none;" %>
            </div>
          <% end %>

          <div style="margin-top: 1rem; display: flex; gap: 0.75rem; flex-wrap: wrap;">
            <%= link_to "Realizar exame",
                        realizar_exame_path(exame),
                        style: "display: inline-block; padding: 0.45rem 0.9rem; border-radius: 8px; background: #16a34a; color: #fff; font-weight: 600; text-decoration: none;" %>
            <%= link_to "Remarcar exame",
                        remarcar_exame_path(exame),
                        style: "display: inline-block; padding: 0.45rem 0.9rem; border-radius: 8px; background: #f59e0b; color: #fff; font-weight: 600; text-decoration: none;" %>
          </div>
        </div>
      <% end %>
    <% else %>
      <div style="padding: 1.25rem; border-radius: 12px; border: 1px dashed #cbd5f5; background: #eef2ff; color: #4338ca;">
        Nenhum exame registrado para esta consulta.
      </div>
    <% end %>
  </div>
</div>

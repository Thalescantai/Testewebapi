<% content_for :title, "Solicitações de materiais" %>

<div class="container-xl py-4">
  <section style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
    <div>
      <h1 style="margin: 0; font-size: 2rem; font-weight: 600; color: #1f2937;">Fila de materiais</h1>
      <p style="margin-top: 0.5rem; color: #6b7280;">
        Consultas com pedidos de materiais vinculados aos pacientes.
      </p>
    </div>
  </section>

  <div style="overflow-x: auto; border: 1px solid #e4e7ef; border-radius: 12px; background: #fff; box-shadow: 0 2px 6px rgba(15,23,42,0.05);">
    <table style="width: 100%; border-collapse: collapse; font-size: 0.95rem;">
      <thead>
        <tr style="background: #f4f6fb; text-transform: uppercase; letter-spacing: 0.04em; color: #52606d;">
          <th style="padding: 0.85rem; border-bottom: 1px solid #e4e7ef; text-align: left; min-width: 220px;">Paciente</th>
          <th style="padding: 0.85rem; border-bottom: 1px solid #e4e7ef; text-align: left; min-width: 160px;">Consulta</th>
          <th style="padding: 0.85rem; border-bottom: 1px solid #e4e7ef; text-align: left; min-width: 140px;">Profissional</th>
          <th style="padding: 0.85rem; border-bottom: 1px solid #e4e7ef; text-align: center; min-width: 120px;">Total materiais</th>
          <th style="padding: 0.85rem; border-bottom: 1px solid #e4e7ef; text-align: center; min-width: 180px;">Ações</th>
        </tr>
      </thead>
      <tbody>
        <% if @consultas_para_materiais.any? %>
          <% @consultas_para_materiais.each do |consulta| %>
            <% paciente = consulta.paciente %>
            <tr style="border-bottom: 1px solid #eef1f7;">
              <td style="padding: 0.85rem;">
                <div style="font-weight: 600; color: #1f2937;"><%= paciente&.nome || "—" %></div>
                <% if paciente&.celular.present? %>
                  <div style="font-size: 0.8rem; color: #6b7280;">Contato: <%= paciente.celular %></div>
                <% end %>
              </td>
              <td style="padding: 0.85rem; color: #374151;">
                <div><strong><%= consulta.tipo.presence || "Consulta" %></strong></div>
                <div style="font-size: 0.8rem; color: #6b7280;">
                  <%= consulta.data_hora.present? ? l(consulta.data_hora, format: :long) : "Data não informada" %>
                </div>
              </td>
              <td style="padding: 0.85rem; color: #374151;"><%= consulta.medico&.nome || "—" %></td>
              <td style="padding: 0.85rem; text-align: center; color: #1f2937;">
                <%= consulta.materials.size %>
              </td>
              <td style="padding: 0.85rem; text-align: center;">
                <%= link_to "Ver solicitação de material",
                            consulta_materiais_path(consulta),
                            style: "display: inline-block; padding: 0.45rem 0.95rem; border-radius: 8px; background: #2563eb; color: #fff; font-weight: 600; text-decoration: none;" %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="5" style="padding: 1.25rem; text-align: center; color: #6b7280;">
              Nenhuma solicitação de material registrada.
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
